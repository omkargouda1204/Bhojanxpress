{% extends "base.html" %}

{% block content %}
<!-- Enhanced Hero Section with Dynamic Slider (Increased Height) -->
<div id="mainCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
  {% if slider_images %}
  <div class="carousel-indicators">
    {% for slider in slider_images %}
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="{{ loop.index0 }}" 
            {% if loop.index0 == 0 %}class="active" aria-current="true"{% endif %} 
            aria-label="Slide {{ loop.index }}"></button>
    {% endfor %}
  </div>
  <div class="carousel-inner rounded-4 shadow-lg">
    {% for slider in slider_images %}
    <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
      <img src="{{ url_for('static', filename='uploads/sliders/' + slider.image_filename) }}" 
           class="d-block w-100" 
           style="height: 350px; object-fit: cover; filter: brightness(0.7);" 
           alt="{{ slider.title }}">
      <div class="carousel-caption d-md-block position-absolute top-50 start-50 translate-middle text-center w-75 animate__animated animate__fadeIn">
        <h2 class="display-4 fw-bold text-white text-shadow">{{ slider.title }}</h2>
        {% if slider.subtitle %}<p class="lead fs-5 mb-4 text-white">{{ slider.subtitle }}</p>{% endif %}
        {% if slider.offer_text %}
        <div class="mb-3">
          <span class="badge bg-warning text-dark fs-6 px-3 py-2">{{ slider.offer_text }}</span>
        </div>
        {% endif %}
        {% if slider.button_text and slider.button_link %}
        <a href="{{ slider.button_link }}" class="btn btn-{{ slider.button_color or 'warning' }} btn-lg shadow-lg px-4 py-2 animate__animated animate__pulse animate__infinite">
          {{ slider.button_text }} <i class="fas fa-arrow-right ms-2"></i>
        </a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <!-- Fallback to default sliders if no dynamic sliders are available -->
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
  </div>
  <div class="carousel-inner rounded-4 shadow-lg">
    <!-- Slide 1: Pizza and Fast Food -->
    <div class="carousel-item active">
      <img src="{{ url_for('static', filename='images/food-slider-1.jpg') }}" class="d-block w-100" style="height: 350px; object-fit: cover; filter: brightness(0.7);" alt="Delicious Pizza and Burgers">
      <div class="carousel-caption d-md-block position-absolute top-50 start-50 translate-middle text-center w-75 animate__animated animate__fadeIn">
        <h2 class="display-4 fw-bold text-white text-shadow">Welcome to BhojanXpress</h2>
        <p class="lead fs-5 mb-4 text-white">Delicious food delivered fast, fresh, and hot to your doorstep.</p>
        <a href="{{ url_for('user.menu') }}" class="btn btn-warning btn-lg shadow-lg px-4 py-2 animate__animated animate__pulse animate__infinite">Order Now <i class="fas fa-arrow-right ms-2"></i></a>
      </div>
    </div>
    <!-- Slide 2: Breakfast and Healthy Options -->
    <div class="carousel-item">
      <img src="{{ url_for('static', filename='images/food-slider-2.jpg') }}" class="d-block w-100" style="height: 350px; object-fit: cover; filter: brightness(0.7);" alt="Healthy Breakfast Options">
      <div class="carousel-caption d-md-block position-absolute top-50 start-50 translate-middle text-center w-75">
        <h2 class="display-5 fw-bold text-white text-shadow">Fresh & Healthy Meals</h2>
        <p class="fs-5 mb-4 text-white">Start your day with nutritious and delicious options.</p>
        <a href="{{ url_for('user.menu') }}" class="btn btn-primary btn-lg shadow px-4 py-2">Browse Menu <i class="fas fa-utensils ms-2"></i></a>
      </div>
    </div>
    <!-- Slide 3: Desserts and Ice Cream -->
    <div class="carousel-item">
      <img src="{{ url_for('static', filename='images/food-slider-3.jpg') }}" class="d-block w-100" style="height: 350px; object-fit: cover; filter: brightness(0.7);" alt="Delicious Desserts and Ice Cream">
      <div class="carousel-caption d-md-block position-absolute top-50 start-50 translate-middle text-center w-75">
        <h2 class="display-5 fw-bold text-white text-shadow">Sweet Treats Await</h2>
        <p class="fs-5 mb-4 text-white">Indulge in our premium desserts and ice cream.</p>
        <a href="{{ url_for('user.menu') }}" class="btn btn-success btn-lg shadow px-4 py-2">Try Desserts <i class="fas fa-ice-cream ms-2"></i></a>
      </div>
    </div>
    <!-- Slide 4: BhojanXpress Branding -->
    <div class="carousel-item">
      <img src="{{ url_for('static', filename='images/food-slider-4.jpg') }}" class="d-block w-100" style="height: 350px; object-fit: cover; filter: brightness(0.7);" alt="BhojanXpress - Quality Food">
      <div class="carousel-caption d-md-block position-absolute top-50 start-50 translate-middle text-center w-75 text-white">
        <h2 class="display-5 fw-bold">Quality &amp; Taste</h2>
        <p class="fs-5 mb-4">Experience the best food delivery in town.</p>
        {% if not current_user.is_authenticated %}
        <a href="{{ url_for('auth.register') }}" class="btn btn-light btn-lg shadow px-4 py-2">Join Now <i class="fas fa-user-plus ms-2"></i></a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
  <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<!-- Round Category Icons Below Slider -->
<section class="container-fluid bg-light py-4 mb-5 round-categories-section">
  <div class="container">
    <h3 class="text-center mb-4 fw-bold text-dark" style="text-align: center;">Browse by Category</h3>
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="category-scroll-container">
          <div class="d-flex category-items-wrapper" id="categoryWrapper">
            {% if categories %}
              {% for category in categories %}
              <div class="category-item text-center mx-3 flex-shrink-0">
                <a href="{{ url_for('user.menu', category=category.name) }}" class="text-decoration-none">
                  <div class="category-card overflow-hidden rounded-4 shadow-sm">
                    <div class="category-image-wrapper">
                      {% if category.image_url %}
                        <img src="{{ category.image_url }}" alt="{{ category.display_name }}" class="category-img">
                      {% else %}
                        <div class="category-placeholder bg-gradient">
                          <i class="fas fa-{{
                            'leaf' if category.name == 'appetizer' else
                            'drumstick-bite' if category.name == 'main_course' else
                            'birthday-cake' if category.name == 'dessert' else
                            'coffee' if category.name == 'beverage' else
                            'cookie-bite' if category.name == 'snacks' else
                            'utensils'
                          }} fa-3x text-white"></i>
                        </div>
                      {% endif %}
                      <div class="category-overlay">
                        <h6 class="category-name text-white fw-bold mb-0">{{ category.display_name }}</h6>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
              {% endfor %}
            {% else %}
           {% endif %}
           </section>

<!-- Enhanced Offers for You Section with Auto-Slider -->
{% if active_coupons %}
<section class="container-fluid my-4 offers-section">
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-between mb-3">
        <div class="text-center w-100 mb-2 mb-md-0">
            <h2 class="mb-0 fw-bold text-center">Offers for you</h2>
            <p class="text-muted small mt-1 text-center">Use these coupons to get amazing deals!</p>
        </div>
        {% if active_coupons|length >= 4 %}
        <div class="slider-controls d-none d-md-flex">
            <button id="offersSliderPrev" class="btn btn-outline-primary btn-sm me-2 rounded-circle" style="width: 40px; height: 40px;">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="offersSliderNext" class="btn btn-outline-primary btn-sm rounded-circle" style="width: 40px; height: 40px;">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        {% endif %}
    </div>
    
    <div class="position-relative">
        {% if active_coupons|length >= 4 %}
        <!-- Auto-Slider Container for 4+ coupons -->
        <div id="offersSliderContainer" class="offers-slider-container">
            <div id="offersSlider" class="offers-slider d-flex transition-all" style="transition: transform 0.3s ease;">
                {% for coupon in active_coupons %}
                <div class="offer-slide flex-shrink-0" style="width: 320px;">
                    <div class="coupon-item me-3">
                        <div id="coupon-card-{{ coupon.id }}" class="card border-0 shadow-sm h-100 coupon-card" style="border-radius: 10px; background: linear-gradient(135deg, {{ '#FF6B35' if loop.index0 % 4 == 0 else '#3A86FF' if loop.index0 % 4 == 1 else '#38B000' if loop.index0 % 4 == 2 else '#9D4EDD' }} 0%, {{ '#FCA311' if loop.index0 % 4 == 0 else '#5BC0EB' if loop.index0 % 4 == 1 else '#6FFF74' if loop.index0 % 4 == 2 else '#C77DFF' }} 100%);">
                            <div class="card-body text-white p-3">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bg-white rounded-circle p-2 me-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i class="fas {{ 'fa-percentage' if coupon.discount_type == 'percentage' else 'fa-tag' }} text-{{ 'danger' if loop.index0 % 4 == 0 else 'primary' if loop.index0 % 4 == 1 else 'success' if loop.index0 % 4 == 2 else 'purple' }}" style="font-size: 1.25rem;"></i>
                                    </div>
                                    <h5 class="card-title mb-0 fw-bold">{{ coupon.code }}</h5>
                                </div>

                                <div class="card-text mb-3">
                                    <div class="mb-1">{{ coupon.description }}</div>
                                    <div class="fw-bold">
                                        {% if coupon.discount_type == 'percentage' %}
                                        Get {{ coupon.discount_value }}% OFF
                                        {% else %}
                                        Get ‚Çπ{{ "%.0f"|format(coupon.discount_value) }} OFF
                                        {% endif %}
                                        
                                        {% if coupon.min_order_amount > 0 %}
                                        on orders worth ‚Çπ{{ "%.0f"|format(coupon.min_order_amount) }} or more
                                        {% endif %}
                                    </div>
                                    <div class="small mt-1">Valid till: {{ coupon.valid_until.strftime('%d %b %Y') }}</div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <button class="btn btn-light btn-sm copy-coupon-btn" 
                                            data-code="{{ coupon.code }}" 
                                            style="font-size: 0.8rem;">
                                        <i class="fas fa-copy me-1"></i> Copy Code
                                    </button>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Slider Indicators -->
        <div class="slider-indicators d-flex justify-content-center mt-3">
            {% for i in range((active_coupons|length + 2) // 3) %}
            <button class="slider-dot {{ 'active' if loop.index0 == 0 else '' }}" data-slide="{{ loop.index0 }}"></button>
            {% endfor %}
        </div>
        
        {% else %}
        <!-- Regular horizontal scroll for less than 4 coupons -->
        <div class="coupon-scroll-container">
            <div class="d-flex flex-nowrap coupon-items-row" style="overflow-x: auto; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory;">
                {% for coupon in active_coupons %}
                <div class="coupon-item me-3" style="min-width: 320px; scroll-snap-align: start;">
                    <div id="coupon-card-{{ coupon.id }}" class="card border-0 shadow-sm h-100 coupon-card" style="border-radius: 10px; background: linear-gradient(135deg, {{ '#FF6B35' if loop.index0 % 4 == 0 else '#3A86FF' if loop.index0 % 4 == 1 else '#38B000' if loop.index0 % 4 == 2 else '#9D4EDD' }} 0%, {{ '#FCA311' if loop.index0 % 4 == 0 else '#5BC0EB' if loop.index0 % 4 == 1 else '#6FFF74' if loop.index0 % 4 == 2 else '#C77DFF' }} 100%);">
                        <div class="card-body text-white p-3">
                            <div class="d-flex align-items-center mb-2">
                                <div class="bg-white rounded-circle p-2 me-2 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="fas {{ 'fa-percentage' if coupon.discount_type == 'percentage' else 'fa-tag' }} text-{{ 'danger' if loop.index0 % 4 == 0 else 'primary' if loop.index0 % 4 == 1 else 'success' if loop.index0 % 4 == 2 else 'purple' }}" style="font-size: 1.25rem;"></i>
                                </div>
                                <h5 class="card-title mb-0 fw-bold">{{ coupon.code }}</h5>
                            </div>

                            <div class="card-text mb-3">
                                <div class="mb-1">{{ coupon.description }}</div>
                                <div class="fw-bold">
                                    {% if coupon.discount_type == 'percentage' %}
                                    Get {{ coupon.discount_value }}% OFF
                                    {% else %}
                                    Get ‚Çπ{{ "%.0f"|format(coupon.discount_value) }} OFF
                                    {% endif %}
                                    
                                    {% if coupon.min_order_amount > 0 %}
                                    on orders worth ‚Çπ{{ "%.0f"|format(coupon.min_order_amount) }} or more
                                    {% endif %}
                                </div>
                                <div class="small mt-1">Valid till: {{ coupon.valid_until.strftime('%d %b %Y') }}</div>
                            </div>

                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-light btn-sm copy-coupon-btn" 
                                        data-code="{{ coupon.code }}" 
                                        style="font-size: 0.8rem;">
                                    <i class="fas fa-copy me-1"></i> Copy Code
                                </button>
                                
                                <button class="btn btn-light btn-sm text-primary apply-coupon-btn" 
                                        data-coupon-code="{{ coupon.code }}"
                                        style="font-size: 0.8rem;" onclick="applyCoupon('{{ coupon.code }}')">
                                    <i class="fas fa-shopping-cart me-1"></i> Apply Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

<!-- Most Popular Items Section -->
{% if popular_items %}
<section class="container-fluid my-4">
    <div class="text-center mb-3">
        <h2 class="mb-0 fw-bold">Most Popular</h2>
        <p class="text-muted small mt-1">Top {{ popular_items|length }} most ordered items</p>
    </div>
    
    <div class="scroll-container">
        <div class="row flex-nowrap popular-items-row">
            {% for item in popular_items[:10] %}
            <div class="col-2 food-item-col">
                <div class="card h-100 food-card border-0 shadow-sm clickable-card" 
                     onclick="showFoodDetails({{ item.id }})">
                    <div class="position-relative food-img-container">
                        {% if item.image_url %}
                        <img src="{{ item.image_url }}" alt="{{ item.name }}" class="card-img-top food-img">
                        {% elif item.image_path %}
                        <img src="{{ url_for('static', filename=item.image_path) }}" alt="{{ item.name }}" class="card-img-top food-img">
                        {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                            <i class="fas fa-utensils text-muted fa-2x"></i>
                        </div>
                        {% endif %}
                        <span class="badge bg-danger position-absolute top-0 end-0 m-2">
                            <i class="fas fa-fire me-1"></i> Popular
                        </span>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">{{ item.name }}</h6>
                        <p class="card-text text-muted small">{{ item.description|truncate(50) }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">‚Çπ{{ "%.0f"|format(item.price) }}</span>
                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); addToCart({{ item.id }})">
                                <i class="fas fa-cart-plus fa-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Menu Items Section -->
{% if featured_items %}
<section class="container-fluid my-4">
    <div class="mb-4 text-center">
        <h2 class="mb-3 fw-bold featured-menu-title">Featured Menu Items</h2>
        <div class="d-flex justify-content-end">
            <a href="{{ url_for('user.menu') }}" class="btn btn-outline-primary">View All <i class="fas fa-arrow-right ms-1"></i></a>
        </div>
    </div>

    <div class="row g-4">
        {% for item in featured_items[:12] %}
        <div class="col-6 col-sm-4 col-md-4 col-lg-3 col-xl-2">
            <div class="card h-100 food-card border-0 shadow-sm clickable-card" 
                 onclick="showFoodDetails({{ item.id }})">
                <div class="position-relative food-img-container">
                    {% if item.image_url %}
                    <img src="{{ item.image_url }}" alt="{{ item.name }}" class="card-img-top food-img">
                    {% elif item.image_path %}
                    <img src="{{ url_for('static', filename=item.image_path) }}" alt="{{ item.name }}" class="card-img-top food-img">
                    {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                        <i class="fas fa-utensils text-muted fa-2x"></i>
                    </div>
                    {% endif %}
                    <span class="badge position-absolute top-0 end-0 m-2 {% if item.is_available %}bg-success{% else %}bg-danger{% endif %}">
                        {% if item.is_available %}Available{% else %}Sold Out{% endif %}
                    </span>
                </div>
                <div class="card-body">
                    <h6 class="card-title">{{ item.name }}</h6>
                    <p class="card-text text-muted small">{{ item.description|truncate(50) }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="fw-bold">‚Çπ{{ "%.0f"|format(item.price) }}</span>
                        {% if item.is_available %}
                        <button class="btn btn-sm btn-warning" onclick="event.stopPropagation(); addToCart({{ item.id }})">
                            <i class="fas fa-shopping-cart fa-lg"></i>
                        </button>
                        {% else %}
                        <button class="btn btn-sm btn-secondary" disabled>
                            <i class="fas fa-shopping-cart fa-lg"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
<!-- Why Choose BhojanXpress Section with Font Awesome Icons -->
<section class="why-choose-section">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-5">
        <h2 class="display-5 fw-bold text-white">Why Choose BhojanXpress?</h2>
        <p class="lead text-white-50">Experience the difference with our premium food delivery service</p>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="feature-card text-center">
          <div class="feature-icon">
            <i class="fas fa-shipping-fast"></i>
          </div>
          <h4 class="feature-title">Lightning Fast Delivery</h4>
          <p class="feature-description">Get your favorite meals delivered in 30 minutes or less. Hot, fresh, and on time - every time!</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="feature-card text-center">
          <div class="feature-icon">
            <i class="fas fa-medal"></i>
          </div>
          <h4 class="feature-title">Premium Quality</h4>
          <p class="feature-description">Fresh ingredients, expert chefs, and hygienic preparation ensure every bite is delicious and safe.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="feature-card text-center">
          <div class="feature-icon">
            <i class="fas fa-headset"></i>
          </div>
          <h4 class="feature-title">24/7 Support</h4>
          <p class="feature-description">Our dedicated customer support team is always ready to help you with your orders and queries.</p>
        </div>
      </div>
    </div>
  </div>
</section>



{% block extra_css %}
<style>
  /* Coupon Section Styling (Dominos Style) */
.coupon-scroll-container {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 0;
  scrollbar-width: thin;
  scrollbar-color: #ddd #f5f5f5;
}

.coupon-scroll-container::-webkit-scrollbar {
  height: 8px;
}

.coupon-scroll-container::-webkit-scrollbar-track {
  background: #f5f5f5;
  border-radius: 10px;
}

.coupon-scroll-container::-webkit-scrollbar-thumb {
  background: #ddd;
  border-radius: 10px;
}

.coupon-scroll-container::-webkit-scrollbar-thumb:hover {
  background: #ccc;
}

.coupon-items-row {
  padding: 8px 4px;
}

.coupon-card {
  transition: all 0.3s ease;
  overflow: hidden;
}

.coupon-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
}

.coupon-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
}

.coupon-card .copy-coupon-btn:hover {
  background-color: #f8f9fa;
  transform: translateY(-2px);
}

  /* Common styles */
.container-fluid {
    padding-left: 1.5rem;
    padding-right: 1.5rem;
    width: 100%;
}

/* Scroll container for Popular Items */
.scroll-container {
    width: 100%;
    overflow-x: auto;
    padding-bottom: 1rem;
}

.popular-items-row {
    flex-wrap: nowrap;
    margin-right: -0.5rem;
    margin-left: -0.5rem;
}

.food-item-col {
    padding: 0 0.5rem;
    flex: 0 0 auto;
    width: 16.666667%;
}

/* Food card styles */
.food-card {
    transition: all 0.3s ease;
}

/* Responsive image container with aspect ratio */
.food-img-container {
    position: relative;
    padding-top: 100%; /* 1:1 Aspect Ratio */
    overflow: hidden;
}

.food-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Card body spacing */
.card-body {
    padding: 1.25rem; /* Increased padding */
}

.card-title {
    font-size: 1rem;
    margin-bottom: 0.75rem;
}

.card-text {
    margin-bottom: 1rem;
}

/* Scrollbar styling */
.scroll-container::-webkit-scrollbar {
    height: 6px;
}

.scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.scroll-container::-webkit-scrollbar-thumb {
    background: #fd7e14;
    border-radius: 10px;
}

/* Responsive */
@media (max-width: 1200px) {
    .container-fluid {
        padding-left: 2rem;
        padding-right: 2rem;
    }
}

@media (max-width: 992px) {
    .container-fluid {
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }
    
    /* Adjust card styles */
    .food-card .card-title {
        font-size: 0.95rem;
    }
    
    .food-card .card-text {
        font-size: 0.85rem;
    }
}

@media (max-width: 768px) {
    .container-fluid {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    /* Further adjust card styles */
    .food-card .card-body {
        padding: 0.75rem;
    }
}

@media (max-width: 576px) {
    /* Optimize for mobile */
    .food-card .card-body {
        padding: 0.5rem;
    }
    
    .food-card .card-title {
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }
    
    .food-card .card-text,
    .food-card .price {
        font-size: 0.8rem;
    }
}

/* Increase Slider Size */
.carousel-inner {
    height: 800px !important;
}

.carousel-item img {
    height: 800px !important;
    object-fit: cover;
}

/* Remove Empty Space */
section {
    margin-bottom: 2rem !important;
}

.container {
    padding-left: 1rem;
    padding-right: 1rem;
}

/* Card Hover Effects */
.food-card:hover .food-img,
.clickable-card:hover .food-img {
    transform: scale(1.08);
}

.food-img {
    transition: transform 0.3s ease;
}

@media (max-width: 768px) {
    .carousel-inner {
        height: 350px !important;
    }
    
    .carousel-item img {
        height: 350px !important;
    }
    
    .popular-scroll-container,
    .featured-scroll-container {
        margin: 0 -0.5rem;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }
}
    
        
        /* Mobile adjustments for popular items */
        .popular-items-wrapper .flex-shrink-0 {
            min-width: 240px !important;
        }
        
        /* Mobile adjustments for offers */
        .offers-wrapper .flex-shrink-0 {
            min-width: 280px !important;
        }
        
        /* Mobile adjustments for category items */
        .category-item {
            min-width: 120px !important;
        }
        
        .category-card {
            width: 120px !important;
            height: 120px !important;
        }
    
    .text-shadow {
        text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    }

    

    /* Category cards */
    .category-card {
        transition: all 0.3s ease;
    }

    .category-link:hover .category-card {
        transform: translateY(-5px);
    }

    .category-card .card-img-wrapper::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.7) 100%);
        opacity: 0;
        transition: all 0.3s ease;
    }

    .category-link:hover .category-card .card-img-wrapper::after {
        opacity: 1;
    }

    
    /* Animation for "Order Now" button */
    .animate__pulse {
        animation-duration: 2s !important;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    /* Enhanced Copy System Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(50px) scale(0.8); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    @keyframes successPulse {
        0% { transform: scale(1); box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); }
        50% { transform: scale(1.1); box-shadow: 0 6px 25px rgba(40, 167, 69, 0.6); }
        100% { transform: scale(1); box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); }
    }

    /* Round category section */
    .round-categories-section {
        margin-top: -30px;
        position: relative;
        z-index: 10;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        padding: 30px 0;
        backdrop-filter: blur(10px);
    }

    /* Enhanced category styling */
    .category-item {
        min-width: 150px;
        flex-shrink: 0;
    }

    .category-card {
        width: 150px;
        height: 150px;
        position: relative;
        transition: all 0.3s ease;
        cursor: pointer;
        overflow: hidden;
        border: 2px solid transparent;
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.1);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .category-card:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3) !important;
        border-color: rgba(255, 255, 255, 0.3);
    }

    .category-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        animation: shimmer 3s infinite linear;
    }

    .category-card:hover::before {
        opacity: 1;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .category-image-wrapper {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
    }

    .category-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.3s ease;
    }

    .category-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
    }

    .category-placeholder i {
        color: rgba(255, 255, 255, 0.9);
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .category-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        padding: 15px 10px 10px;
        transform: translateY(0);
    }

    .category-name {
        font-size: 0.9rem;
        text-align: center;
        color: white;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    /* Why Choose section styling */
    .why-choose-section {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        padding: 80px 0;
        margin-top: 50px;
    }

    .feature-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        height: 100%;
    }

    .feature-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.15);
    }

    .feature-icon {
        font-size: 3rem;
        color: #fd7e14;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }

    .feature-card:hover .feature-icon {
        transform: scale(1.1);
    }

    .feature-title {
        color: #fff;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .feature-description {
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
    }

    
    /* Responsive improvements */
    @media (max-width: 992px) {
        .offers-wrapper,
        .popular-items-wrapper {
            gap: 0.75rem;
        }
        
        .flex-shrink-0 {
            min-width: 250px;
        }
    }

    @media (max-width: 768px) {
        .offers-wrapper,
        .popular-items-wrapper {
            gap: 0.5rem;
        }
        
        .flex-shrink-0 {
            min-width: 220px;
        }
        
        .round-categories-section {
            margin-top: -20px;
            padding: 20px 0;
        }
        
        .category-card {
            width: 120px;
            height: 120px;
        }
        
        .category-item {
            min-width: 120px;
        }
    }


.copy-coupon-btn {
  position: relative;
  z-index: 9999;
  pointer-events: auto;
}
    .category-link:hover .category-card .card-img-wrapper::after {
        opacity: 1;
    }

    .special-offer {
        transition: all 0.3s ease;
    }

    .special-offer:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }

    /* Animation for "Order Now" button */
    .animate__pulse {
        animation-duration: 2s !important;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
        }
    }

    .mb-0 fw-bold{

        text-align: center;
    }
   

</style>
{% endblock %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add animations to elements when they come into view
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate__animated', 'animate__fadeIn');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    // Observe section headings
    document.querySelectorAll('section h2').forEach(el => {
        observer.observe(el);
    });

    // Initialize coupon copy functionality
    initializeCouponCopy();

    // Simple and reliable coupon copy functionality
    function initializeCouponCopy() {
        const copyButtons = document.querySelectorAll('.copy-coupon-btn');
        console.log('üîç Found copy buttons:', copyButtons.length);
        copyButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                console.log("Click event triggered for:", this);
                e.preventDefault();
                e.stopPropagation();
                console.log('üñ±Ô∏è Copy button clicked');
                const code = this.getAttribute('data-code');
                if (!code) {
                    alert('No coupon code found!');
                    return;
                }
                
                copyToClipboard(code, this);
                // Show success message
                alert('Coupon code copied to clipboard!');
            });
        });
    }
    
    // ENHANCED AND RELIABLE COPY FUNCTIONALITY
    function copyToClipboard(text, button) {
        console.log('üìã Attempting to copy:', text);
        
        // Method 1: Modern Clipboard API
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('‚úÖ Clipboard API successful');
                showCopySuccess(button, text);
            }).catch((err) => {
                console.log('‚ö†Ô∏è Clipboard API failed:', err);
                fallbackCopy(text, button);
            });
        } else {
            console.log('üîÑ Using fallback copy method');
            fallbackCopy(text, button);
        }
    }
    
    function fallbackCopy(text, button) {
        try {
            // Method 2: Create a temporary input element
            const tempInput = document.createElement('input');
            tempInput.value = text;
            tempInput.style.position = 'fixed';
            tempInput.style.left = '-9999px';
            tempInput.style.top = '-9999px';
            tempInput.setAttribute('readonly', '');
            
            document.body.appendChild(tempInput);
            
            // Select and copy
            tempInput.select();
            tempInput.setSelectionRange(0, 99999); // For mobile devices
            
            const successful = document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            if (successful) {
                console.log('‚úÖ Fallback copy successful');
                showCopySuccess(button, text);
            } else {
                console.log('‚ùå Fallback copy failed');
                showManualCopy(text);
            }
        } catch (err) {
            console.log('‚ùå Copy exception:', err);
            showManualCopy(text);
        }
    }
    
    function showManualCopy(text) {
        // Final fallback - show modal for manual copy
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Copy Coupon Code</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center">
                        <p>Please copy the code below:</p>
                        <div class="alert alert-primary fs-4 fw-bold user-select-all">${text}</div>
                        <small class="text-muted">Select the code above and press Ctrl+C (Cmd+C on Mac)</small>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        // Remove modal after it's hidden
        modal.addEventListener('hidden.bs.modal', () => {
            document.body.removeChild(modal);
        });
    }
    
    function showCopySuccess(button, text) {
        if (!button) return;
        
        const originalHTML = button.innerHTML;
        const originalClass = button.className;
        
        // Update button to show success
        button.innerHTML = '<i class="fas fa-check me-1"></i> Copied!';
        button.className = button.className.replace('btn-light', 'btn-success');
        button.disabled = true;
        
        // Show toast notification instead of alert
        showToast(`Coupon code "${text}" copied to clipboard!`, 'success');
        
        // Reset button after 3 seconds
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.className = originalClass;
            button.disabled = false;
        }, 3000);
    }
    

    

    


    
    function useDocumentSelection(text) {
        if (window.getSelection && document.createRange) {
            const span = document.createElement('span');
            span.textContent = text;
            span.style.cssText = `
                position: absolute !important;
                left: -9999px !important;
                opacity: 0 !important;
            `;
            
            document.body.appendChild(span);
            const range = document.createRange();
            range.selectNode(span);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            const successful = document.execCommand('copy');
            selection.removeAllRanges();
            document.body.removeChild(span);
            return successful;
        }
        return false;
    }
    
    function showEnhancedManualCopy(text) {
        // Create a beautiful modal for manual copy
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0,0,0,0.8) !important;
            z-index: 999999 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            animation: fadeIn 0.3s ease !important;
        `;
        
        modal.innerHTML = `
            <div style="
                background: white !important;
                padding: 30px !important;
                border-radius: 15px !important;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3) !important;
                max-width: 500px !important;
                width: 90% !important;
                text-align: center !important;
                animation: slideUp 0.3s ease !important;
            ">
                <div style="color: #dc3545; font-size: 48px; margin-bottom: 20px;">
                    <i class="fas fa-copy"></i>
                </div>
                <h3 style="color: #333; margin-bottom: 15px;">Copy Coupon Code</h3>
                <p style="color: #666; margin-bottom: 20px;">Please select and copy the code below:</p>
                <input type="text" value="${text}" readonly 
                       style="
                           width: 100% !important;
                           padding: 15px !important;
                           font-size: 18px !important;
                           font-weight: bold !important;
                           text-align: center !important;
                           border: 2px solid #007bff !important;
                           border-radius: 8px !important;
                           background: #f8f9fa !important;
                           color: #007bff !important;
                           margin-bottom: 20px !important;
                       "
                       onclick="this.select()" id="manualCopyInput">
                <div>
                    <button onclick="document.getElementById('manualCopyInput').select(); this.parentElement.parentElement.parentElement.remove();" 
                            style="
                                background: #007bff !important;
                                color: white !important;
                                border: none !important;
                                padding: 12px 24px !important;
                                border-radius: 6px !important;
                                font-size: 16px !important;
                                cursor: pointer !important;
                                margin-right: 10px !important;
                            ">
                        <i class="fas fa-copy me-2"></i>Select & Close
                    </button>
                    <button onclick="this.parentElement.parentElement.parentElement.remove();" 
                            style="
                                background: #6c757d !important;
                                color: white !important;
                                border: none !important;
                                padding: 12px 24px !important;
                                border-radius: 6px !important;
                                font-size: 16px !important;
                                cursor: pointer !important;
                            ">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Auto-select the input
        setTimeout(() => {
            const input = document.getElementById('manualCopyInput');
            if (input) {
                input.focus();
                input.select();
            }
        }, 100);
        
        // Close on background click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
    
    function showEnhancedCopySuccess(button, code) {
        console.log('üéâ Enhanced copy success for:', code);
        
        if (button) {
            const originalHtml = button.innerHTML;
            const originalClass = button.className;
            const originalStyle = button.style.cssText;
            
            // Enhanced button animation and styling
            button.innerHTML = '<i class="fas fa-check me-1"></i> Copied!';
            button.style.cssText = `
                ${originalStyle}
                background: linear-gradient(45deg, #28a745, #20c997) !important;
                color: white !important;
                transform: scale(1.05) !important;
                box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4) !important;
                transition: all 0.3s ease !important;
            `;
            button.disabled = true;
            
            // Add pulse animation
            button.style.animation = 'pulse 0.6s ease-in-out';
            
            // Reset button after 3 seconds with smooth transition
            setTimeout(() => {
                button.style.transform = 'scale(1)';
                button.style.boxShadow = '';
                button.style.animation = '';
                setTimeout(() => {
                    button.innerHTML = originalHtml;
                    button.className = originalClass;
                    button.style.cssText = originalStyle;
                    button.disabled = false;
                }, 300);
            }, 2500);
        }
        
        // Show enhanced notification with animation
        showEnhancedNotification(`üéâ Coupon "${code}" copied successfully!`, 'success');
        
        // Add celebration effect
        createCelebrationEffect();
    }
    
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#28a745' : '#007bff'};
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10000;
            font-family: Arial, sans-serif;
            font-size: 14px;
            max-width: 300px;
            word-wrap: break-word;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        // Auto-remove after 3 seconds
        setTimeout(() => {
            if (document.body.contains(notification)) {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                notification.style.transition = 'all 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }
        }, 3000);
    }
    
    // ENHANCED NOTIFICATION SYSTEM
    function showEnhancedNotification(message, type = 'info') {
        // Remove any existing notifications
        document.querySelectorAll('.enhanced-notification').forEach(n => n.remove());
        
        const notification = document.createElement('div');
        notification.className = 'enhanced-notification';
        
        const colors = {
            success: { bg: 'linear-gradient(135deg, #28a745, #20c997)', icon: 'check-circle' },
            error: { bg: 'linear-gradient(135deg, #dc3545, #fd7e14)', icon: 'exclamation-circle' },
            info: { bg: 'linear-gradient(135deg, #007bff, #6f42c1)', icon: 'info-circle' }
        };
        
        const color = colors[type] || colors.info;
        
        notification.style.cssText = `
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            background: ${color.bg} !important;
            color: white !important;
            padding: 16px 24px !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3) !important;
            z-index: 999999 !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 15px !important;
            font-weight: 500 !important;
            max-width: 400px !important;
            word-wrap: break-word !important;
            backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
            transform: translateX(400px) !important;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
        `;
        
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-${color.icon}" style="font-size: 20px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));"></i>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="
                            background: none !important;
                            border: none !important;
                            color: white !important;
                            font-size: 18px !important;
                            cursor: pointer !important;
                            padding: 4px !important;
                            border-radius: 50% !important;
                            width: 28px !important;
                            height: 28px !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            transition: background 0.2s !important;
                        "
                        onmouseover="this.style.background='rgba(255,255,255,0.2)'"
                        onmouseout="this.style.background='none'">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);
        
        // Auto-remove after 4 seconds with animation
        setTimeout(() => {
            if (document.body.contains(notification)) {
                notification.style.transform = 'translateX(400px)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.remove();
                    }
                }, 400);
            }
        }, 4000);
    }
    
    // CELEBRATION EFFECT FOR SUCCESSFUL COPY
    function createCelebrationEffect() {
        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd', '#98d8c8'];
        const particleCount = 15;
        
        for (let i = 0; i < particleCount; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed !important;
                    top: 20px !important;
                    right: 50px !important;
                    width: 8px !important;
                    height: 8px !important;
                    background: ${colors[Math.floor(Math.random() * colors.length)]} !important;
                    border-radius: 50% !important;
                    z-index: 999998 !important;
                    pointer-events: none !important;
                    animation: celebrate${i} 2s ease-out forwards !important;
                `;
                
                // Create unique animation for each particle
                const angle = (i / particleCount) * 360;
                const distance = 80 + Math.random() * 40;
                const keyframes = `
                    @keyframes celebrate${i} {
                        0% { transform: translate(0, 0) scale(1); opacity: 1; }
                        50% { opacity: 1; }
                        100% { 
                            transform: translate(${Math.cos(angle * Math.PI / 180) * distance}px, ${Math.sin(angle * Math.PI / 180) * distance}px) scale(0); 
                            opacity: 0; 
                        }
                    }
                `;
                
                // Add keyframes to document
                const style = document.createElement('style');
                style.textContent = keyframes;
                document.head.appendChild(style);
                
                document.body.appendChild(particle);
                
                // Clean up
                setTimeout(() => {
                    if (document.body.contains(particle)) particle.remove();
                    if (document.head.contains(style)) style.remove();
                }, 2000);
            }, i * 50);
        }
    }
    
    // Initialize copy functionality when DOM is ready
    console.log('Setting up coupon copy initialization...');
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCouponCopy);
    } else {
        initializeCouponCopy();
    }
    
    // Also initialize after any dynamic content loads
    setTimeout(initializeCouponCopy, 1000);

    // Remove coupon functionality
    document.querySelectorAll('.remove-coupon').forEach(button => {
        button.addEventListener('click', function() {
            const couponId = this.getAttribute('data-coupon-id');
            const couponCard = document.getElementById('coupon-card-' + couponId);

            if (confirm('Are you sure you want to remove this coupon?')) {
                if (couponCard) {
                    // Add AJAX call to remove the coupon from user's saved coupons
                    fetch('/api/coupons/remove/' + couponId, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Add fade-out animation
                            couponCard.style.transition = 'all 0.5s ease';
                            couponCard.style.opacity = '0';
                            couponCard.style.transform = 'translateY(20px)';

                            // Remove from DOM after animation completes
                            setTimeout(() => {
                                couponCard.remove();

                                // Check if there are any remaining coupons
                                const remainingCoupons = document.querySelectorAll('.special-offer-card');
                                if (remainingCoupons.length === 0) {
                                    // If no coupons left, hide the entire section
                                    const specialOffersSection = document.getElementById('specialOffersSection');
                                    if (specialOffersSection) {
                                        specialOffersSection.style.display = 'none';
                                    }
                                }
                            }, 500);
                        } else {
                            alert('Failed to remove coupon: ' + (data.message || 'Unknown error'));
                        }
                    })
                    .catch(error => {
                        console.error('Error removing coupon:', error);
                        alert('Failed to remove coupon. Please try again.');
                    });
                }
            }
        });
    });

    // Hide Special Offers section if no coupons are available
    const specialOffersSection = document.getElementById('specialOffersSection');
    const couponCards = document.querySelectorAll('.special-offer-card');

    if (specialOffersSection && couponCards.length === 0) {
        specialOffersSection.style.display = 'none';
    }
});

// Global functions for food interactions
function showFoodDetails(foodId) {
    // Redirect to food detail page
    window.location.href = `/food/${foodId}`;
}

function addToCart(foodId) {
    // Add to cart via AJAX
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
    
    fetch(`/add_to_cart/${foodId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({
            quantity: 1
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Item added to cart!', 'success');
            // Update cart count if element exists
            const cartCount = document.querySelector('.cart-count-badge');
            if (cartCount) {
                cartCount.textContent = data.cart_count;
                cartCount.style.display = 'block';
            }
        } else {
            showToast(data.message || 'Error adding to cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error adding to cart', 'error');
    });
}

// UNIFIED Copy coupon code functionality - Uses enhanced system
function copyCouponCode(code, button = null) {
    // Use our new enhanced copy system
    copyToClipboard(code, button);
}

// Apply coupon functionality
function applyCoupon(code) {
    // Store coupon in session storage for use in cart
    sessionStorage.setItem('appliedCoupon', code);
    showToast(`Coupon "${code}" will be applied at checkout!`, 'success');
    // Redirect to cart page
    setTimeout(() => {
        window.location.href = '/cart';
    }, 1000);
}

// Toast notification function
function showToast(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; animation: slideIn 0.3s ease;';
    toast.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 3000);
}

// Add CSS for toast animation
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    /* Offers Auto-Slider Styles */
    .offers-slider-container {
        overflow: hidden;
        position: relative;
    }
    
    .offers-slider {
        display: flex;
        transition: transform 0.3s ease;
        gap: 1rem;
    }
    
    .offer-slide {
        flex: 0 0 auto;
    }
    
    .slider-indicators {
        gap: 0.5rem;
    }
    
    .slider-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid #ddd;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .slider-dot.active {
        background: var(--primary-color, #007bff);
        border-color: var(--primary-color, #007bff);
    }
    
    .slider-dot:hover {
        border-color: var(--primary-color, #007bff);
    }
    
    @media (max-width: 768px) {
        .offer-slide {
            width: 280px !important;
        }
        
        .slider-controls {
            display: none !important;
        }
    }
`;
document.head.appendChild(style);

// Offers Auto-Slider Functionality
class OffersSlider {
    constructor() {
        this.slider = document.getElementById('offersSlider');
        this.container = document.getElementById('offersSliderContainer');
        this.prevBtn = document.getElementById('offersSliderPrev');
        this.nextBtn = document.getElementById('offersSliderNext');
        this.dots = document.querySelectorAll('.slider-dot');
        
        if (!this.slider) return;
        
        this.currentIndex = 0;
        this.totalSlides = this.slider.children.length;
        this.slidesPerView = this.getSlidesPerView();
        this.maxIndex = Math.max(0, this.totalSlides - this.slidesPerView);
        this.autoSlideInterval = null;
        this.isHovered = false;
        
        this.init();
    }
    
    init() {
        this.setupEventListeners();
        this.startAutoSlide();
        this.updateSlider();
    }
    
    getSlidesPerView() {
        const containerWidth = this.container.offsetWidth;
        const slideWidth = 320; // Width of each slide
        const gap = 16; // Gap between slides
        return Math.floor(containerWidth / (slideWidth + gap));
    }
    
    setupEventListeners() {
        if (this.prevBtn) {
            this.prevBtn.addEventListener('click', () => this.previousSlide());
        }
        
        if (this.nextBtn) {
            this.nextBtn.addEventListener('click', () => this.nextSlide());
        }
        
        this.dots.forEach((dot, index) => {
            dot.addEventListener('click', () => this.goToSlide(index));
        });
        
        // Pause auto-slide on hover
        this.container.addEventListener('mouseenter', () => {
            this.isHovered = true;
            this.stopAutoSlide();
        });
        
        this.container.addEventListener('mouseleave', () => {
            this.isHovered = false;
            this.startAutoSlide();
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            this.slidesPerView = this.getSlidesPerView();
            this.maxIndex = Math.max(0, this.totalSlides - this.slidesPerView);
            this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
            this.updateSlider();
        });
        
        // Touch events for mobile
        let startX = 0;
        let currentX = 0;
        let isDragging = false;
        
        this.slider.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
            this.stopAutoSlide();
        });
        
        this.slider.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            currentX = e.touches[0].clientX;
        });
        
        this.slider.addEventListener('touchend', () => {
            if (!isDragging) return;
            isDragging = false;
            
            const diff = startX - currentX;
            const threshold = 50;
            
            if (diff > threshold) {
                this.nextSlide();
            } else if (diff < -threshold) {
                this.previousSlide();
            }
            
            if (!this.isHovered) {
                this.startAutoSlide();
            }
        });
    }
    
    updateSlider() {
        const slideWidth = 320; // Width of each slide
        const gap = 16; // Gap between slides
        const translateX = -this.currentIndex * (slideWidth + gap);
        
        this.slider.style.transform = `translateX(${translateX}px)`;
        
        // Update dots
        this.dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === this.currentIndex);
        });
        
        // Update button states
        if (this.prevBtn) {
            this.prevBtn.disabled = this.currentIndex === 0;
        }
        
        if (this.nextBtn) {
            this.nextBtn.disabled = this.currentIndex >= this.maxIndex;
        }
    }
    
    nextSlide() {
        if (this.currentIndex < this.maxIndex) {
            this.currentIndex++;
        } else {
            this.currentIndex = 0; // Loop back to start
        }
        this.updateSlider();
    }
    
    previousSlide() {
        if (this.currentIndex > 0) {
            this.currentIndex--;
        } else {
            this.currentIndex = this.maxIndex; // Loop to end
        }
        this.updateSlider();
    }
    
    goToSlide(index) {
        this.currentIndex = Math.max(0, Math.min(index, this.maxIndex));
        this.updateSlider();
    }
    
    startAutoSlide() {
        if (this.totalSlides <= this.slidesPerView) return; // No need to auto-slide if all slides are visible
        
        this.stopAutoSlide();
        this.autoSlideInterval = setInterval(() => {
            if (!this.isHovered) {
                this.nextSlide();
            }
        }, 4000); // Change slide every 4 seconds
    }
    
    stopAutoSlide() {
        if (this.autoSlideInterval) {
            clearInterval(this.autoSlideInterval);
            this.autoSlideInterval = null;
        }
    }
}

// Initialize offers slider when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    const offersSlider = new OffersSlider();
});
</script>
{% endblock %}