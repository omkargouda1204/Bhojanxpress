<nav class="navbar navbar-expand-lg sticky-top navbar-animated">
    <div class="container-fluid px-4">
        <!-- Brand Logo + Name with Hover Animation -->
        <a class="navbar-brand fw-bold logo-animated d-flex align-items-center me-5" href="{{ url_for('user.home') }}">
            <img src="{{ url_for('static', filename='images/logo.png') }}"
                 alt="BhojanXpress"
                 height="60" width="60"
                 class="me-3 logo-spin logo-round shadow-lg">
            <span class="brand-text fs-3 ms-2 brand-hover-effect">BhojanXpress</span>
        </a>

        <!-- Toggler -->
        <button class="navbar-toggler pulse-effect" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Content -->
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">

            <!-- Left Menus -->
            <ul class="navbar-nav slide-in-left nav-gap me-auto">
                <li class="nav-item"><a class="nav-link nav-hover-effect" href="{{ url_for('user.home') }}"><i class="bi bi-house-door"></i> Home</a></li>
                <li class="nav-item"><a class="nav-link nav-hover-effect" href="{{ url_for('user.menu') }}"><i class="bi bi-card-list"></i> Menu</a></li>
                {% if current_user.is_authenticated %}
                <li class="nav-item"><a class="nav-link nav-hover-effect" href="{{ url_for('user.my_orders') }}"><i class="bi bi-bag-check"></i> My Orders</a></li>
                {% endif %}
                <li class="nav-item"><a class="nav-link nav-hover-effect" href="{{ url_for('user.contact') }}"><i class="bi bi-chat-dots"></i> Contact</a></li>
            </ul>

            <!-- Center Search Bar with Autocomplete (Flipkart style) - Increased Size -->
            <form class="d-flex mx-auto flex-grow-1 justify-content-center position-relative"
                  style="max-width: 800px; min-width: 400px;" method="GET" action="{{ url_for('user.search') }}">
                <div class="input-group w-100 search-container">
                    <input class="form-control search-input border-0 shadow-sm" type="search" name="query" id="search-input"
                           placeholder="Search for food, cuisines, offers..." aria-label="Search"
                           autocomplete="off" style="border-radius: 8px 0 0 8px; font-size: 16px; padding: 16px 20px; height: 56px;">
                    <button class="btn btn-warning search-btn border-0" type="submit" style="border-radius: 0 8px 8px 0; padding: 16px 24px; height: 56px;">
                        <i class="bi bi-search text-white fs-5"></i>
                    </button>
                </div>
                <!-- Search suggestions dropdown -->
                <div id="search-suggestions" class="list-group position-absolute w-100 shadow-lg search-dropdown" 
                     style="top: 100%; z-index: 1050; max-height: 400px; overflow-y: auto; display: none; border-radius: 0 0 8px 8px; background: white; border: 1px solid #ddd;">
                    <!-- Suggestions will be populated by JavaScript -->
                </div>
            </form>

            <!-- Right Options -->
            <ul class="navbar-nav slide-in-right nav-gap ms-auto">
                {% if current_user.is_authenticated %}
                <li class="nav-item me-3">
                    <a class="nav-link position-relative cart-link nav-hover-effect" href="{{ url_for('user.cart') }}">
                        <i class="bi bi-cart3"></i> Cart
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-count-badge">0</span>
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle nav-hover-effect" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> {{ current_user.username }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end animated fadeInDown">
                        {% if not current_user.is_admin %}
                        <li><a class="dropdown-item" href="{{ url_for('user.profile') }}"><i class="bi bi-person me-2"></i> My Profile</a></li>
                        {% endif %}
                        {% if current_user.is_admin %}
                        <li><a class="dropdown-item" href="{{ url_for('admin.dashboard') }}"><i class="bi bi-speedometer2 me-2"></i> Admin Dashboard</a></li>
                        {% endif %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item"><a class="nav-link nav-hover-effect btn btn-outline-light rounded-pill ms-2 px-3 sign-up-btn" href="{{ url_for('auth.login') }}"><i class="bi bi-box-arrow-in-right"></i> Login</a></li>
                <li class="nav-item"><a class="nav-link nav-hover-effect btn btn-light rounded-pill ms-2 px-3 text-dark fw-bold" href="{{ url_for('auth.register') }}"><i class="bi bi-person-plus"></i> Sign Up</a></li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<style>
    /* ================================
       NAVBAR BACKGROUND & STYLING
    ================================ */
    .navbar-animated {
      background: linear-gradient(135deg, rgba(255,94,58,0.95), rgba(253,126,20,0.95)),
                  url("{{ url_for('static', filename='images/navbar-bg.jpg') }}") center/cover no-repeat;
      box-shadow: 0 4px 16px rgba(0,0,0,0.35);
      padding: 0.9rem 1.5rem;
      transition: all 0.3s ease;
    }
    .navbar-animated:hover {
      background: linear-gradient(135deg, rgba(253,126,20,0.95), rgba(255,94,58,0.95)),
                  url("{{ url_for('static', filename='images/navbar-bg.jpg') }}") center/cover no-repeat;
    }

    /* Logo round shape */
    .logo-round {
      border-radius: 50%;
      border: 2px solid #fff;
      padding: 4px;
      background: #fff;
      transition: transform 0.6s ease-in-out;
    }
    .logo-round:hover {
      transform: rotate(360deg);
    }
    .brand-text {
      font-size: 1.7rem;
      font-weight: bold;
      letter-spacing: 1.5px;
      color: #fff;
      animation: fadeInRight 1s ease;
    }

    /* ================================
       NAV LINKS
    ================================ */
    .nav-gap .nav-item {
      margin: 0 0.8rem;
    }
    .nav-hover-effect {
      font-size: 1.1rem;
      font-weight: 500;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      color: #fff !important;
      transition: all 0.3s ease;
    }
    .nav-hover-effect:hover {
      background: rgba(255,255,255,0.15);
      color: #ffe066 !important;
      transform: translateY(-2px) scale(1.05);
    }

    /* ================================
       SEARCH BAR
    ================================ */
    .search-input {
      font-size: 1rem;
      padding: 1rem 1.25rem;
      border-radius: 8px 0 0 8px;
      border: 2px solid #fff;
      height: 56px;
    }
    .search-input:focus {
      outline: none;
      border-color: #ffd43b;
      box-shadow: 0 0 0 0.2rem rgba(255, 212, 59, 0.25);
    }
    .search-btn {
      font-size: 1.1rem;
      padding: 1rem 1.5rem;
      border-radius: 0 8px 8px 0;
      background: #ffd43b;
      border: 2px solid #ffd43b;
      transition: all 0.3s ease;
      height: 56px;
    }
    .search-btn:hover {
      background: #ffcd39;
      border-color: #ffcd39;
      transform: scale(1.02);
    }

    /* Search container improvements */
    .search-container {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    .search-container:hover {
        box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    .search-dropdown {
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 8px 8px;
    }
    .search-dropdown .list-group-item:hover {
        background-color: #f8f9fa;
    }
    .search-dropdown .list-group-item.active {
        background-color: #e3f2fd;
        border-color: #2196f3;
    }

    /* ================================
       BRAND HOVER ANIMATION
    ================================ */
    .brand-hover-effect {
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    .brand-hover-effect:hover {
        color: #ffd43b !important;
        transform: scale(1.05);
        text-shadow: 0 0 10px rgba(255, 212, 59, 0.5);
    }

    /* ================================
       ANIMATIONS
    ================================ */
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navbar scroll effect
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar-animated');
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Update cart count
    function updateCartCount() {
        fetch('/cart/count')
        .then(response => response.json())
        .then(data => {
            const cartCountElement = document.querySelector('.cart-count-badge');
            if (cartCountElement) {
                cartCountElement.textContent = data.count;
                if (data.count > 0) {
                    cartCountElement.style.display = 'block';
                } else {
                    cartCountElement.style.display = 'none';
                }
            }
        })
        .catch(error => console.error('Error updating cart count:', error));
    }

    // Call immediately and then every 30 seconds
    updateCartCount();
    setInterval(updateCartCount, 30000);

    // Search autocomplete functionality
    const searchInput = document.getElementById('search-input');
    const suggestionsDiv = document.getElementById('search-suggestions');

    if (searchInput && suggestionsDiv) {
        let searchTimeout;

        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(() => {
                fetch(`/search_suggestions?q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            let html = '';
                            data.forEach(item => {
                                html += `
                                    <a href="/food/${item.id}" class="list-group-item list-group-item-action d-flex align-items-center py-2 px-3">
                                        <div class="flex-shrink-0 me-3">
                                            <img src="${item.image_url}" 
                                                 alt="${item.name}" style="width: 48px; height: 48px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="fw-bold text-dark">${item.name}</div>
                                            <div class="small text-muted">₹${item.price.toFixed(2)} • ${item.category}</div>
                                            <div class="small text-truncate text-muted">${item.description}</div>
                                        </div>
                                    </a>
                                `;
                            });
                            suggestionsDiv.innerHTML = html;
                            suggestionsDiv.style.display = 'block';
                        } else {
                            suggestionsDiv.innerHTML = '<div class="list-group-item text-muted text-center py-3">No items found</div>';
                            suggestionsDiv.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        console.error('Search error:', error);
                        suggestionsDiv.style.display = 'none';
                    });
            }, 300);
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && !suggestionsDiv.contains(event.target)) {
                suggestionsDiv.style.display = 'none';
            }
        });

        // Show suggestions when focusing on search input (if it has value)
        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 2) {
                if (suggestionsDiv.innerHTML.trim()) {
                    suggestionsDiv.style.display = 'block';
                }
            }
        });

        // Handle keyboard navigation in suggestions
        searchInput.addEventListener('keydown', function(event) {
            const suggestionItems = suggestionsDiv.querySelectorAll('a');
            let currentIndex = -1;
            
            // Find currently focused suggestion
            for (let i = 0; i < suggestionItems.length; i++) {
                if (suggestionItems[i].classList.contains('active')) {
                    currentIndex = i;
                    break;
                }
            }
            
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (currentIndex < suggestionItems.length - 1) {
                    if (currentIndex >= 0) {
                        suggestionItems[currentIndex].classList.remove('active');
                    }
                    suggestionItems[currentIndex + 1].classList.add('active');
                }
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (currentIndex > 0) {
                    suggestionItems[currentIndex].classList.remove('active');
                    suggestionItems[currentIndex - 1].classList.add('active');
                }
            } else if (event.key === 'Enter') {
                if (currentIndex >= 0) {
                    event.preventDefault();
                    suggestionItems[currentIndex].click();
                }
            }
        });
    }
});
</script>
