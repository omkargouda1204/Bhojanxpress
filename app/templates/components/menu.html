{% extends "base.html" %}

{% block title %}Menu - BhojanXpress{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Filters (Flipkart Style) -->
        <div class="col-lg-3 d-none d-lg-block mb-4" id="filterColumn">
            <!-- Filter Toggle Button for Mobile -->
            <div class="d-lg-none mb-3">
                <button class="btn btn-outline-primary w-100" type="button" id="toggleFiltersBtn">
                    <i class="fas fa-filter me-2"></i>Filters
                </button>
            </div>
            
            <div class="filter-sidebar bg-white shadow-sm rounded p-4" id="filterSidebar">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold mb-0">Filters</h4>
                </div>
                
                <!-- Price Filter -->
                <div class="filter-section mb-4">
                    <h5 class="filter-title d-flex justify-content-between align-items-center">
                        <span>PRICE</span>
                    </h5>
                    
                    <!-- Price Range Slider -->
                    <div class="d-flex justify-content-between mt-2">
                        <select class="form-select form-select-sm" id="minPriceSelect" style="width: 45%;">
                            <option value="">Min</option>
                            <option value="0">₹0</option>
                            <option value="50">₹50</option>
                            <option value="100">₹100</option>
                            <option value="200">₹200</option>
                            <option value="300">₹300</option>
                            <option value="500">₹500</option>
                        </select>
                        <span class="align-self-center mx-2">to</span>
                        <select class="form-select form-select-sm" id="maxPriceSelect" style="width: 45%;">
                            <option value="">Max</option>
                            <option value="100">₹100</option>
                            <option value="200">₹200</option>
                            <option value="300">₹300</option>
                            <option value="500">₹500</option>
                            <option value="1000">₹1000</option>
                            <option value="20000">₹20000+</option>
                        </select>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="filter-section mb-4">
                    <h5 class="filter-title">CATEGORY</h5>
                    <div class="category-filters">
                        {% if categories %}
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="categoryFilter" id="categoryAll" value="all" {% if not current_category or current_category == 'all' %}checked{% endif %}>
                            <label class="form-check-label" for="categoryAll">
                                All Categories
                            </label>
                        </div>
                        {% for category in categories %}
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="categoryFilter" id="category{{ loop.index }}" value="{{ category.name }}" {% if current_category == category.name %}checked{% endif %}>
                            <label class="form-check-label" for="category{{ loop.index }}">
                                {{ category.display_name }}
                            </label>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
                
                <!-- Clear All Filters Button -->
                <div class="d-grid">
                    <button class="btn btn-outline-danger" id="clearAllFiltersBtn">
                        <i class="fas fa-times me-1"></i>Clear All Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9 col-12" id="mainContent">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                <div class="mb-2 mb-md-0">
                    <h2 class="fw-bold mb-1">Our Menu</h2>
                    <p class="text-muted mb-0">
                        <span id="itemsCount">
                            {% if food_items.items %}
                                Showing {{ food_items.items|length }} item{{ 's' if food_items.items|length != 1 else '' }}
                            {% else %}
                                No items available
                            {% endif %}
                        </span>
                        {% if current_category and current_category != 'all' %}
                            in {{ current_category.replace('_', ' ').title() }}
                        {% endif %}
                    </p>
                </div>
                
                <!-- Controls -->
                <div class="d-flex gap-2 flex-wrap">
                    <!-- Sidebar Toggle for Desktop -->
                    <button class="btn btn-outline-secondary d-none d-lg-block" id="toggleSidebarBtn">
                        <i class="fas fa-bars me-1"></i>Toggle Filters
                    </button>
                    
                    <!-- Sort Options -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-sort me-2"></i>Sort by
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="sortItems('name')">Name (A-Z)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortItems('name-desc')">Name (Z-A)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortItems('price-low')">Price: Low to High</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortItems('price-high')">Price: High to Low</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortItems('newest')">Newest First</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Food Items Grid -->
            {% if food_items.items %}
            <div class="row" id="foodItemsContainer">
                {% for item in food_items.items %}
                <div class="col-12 col-sm-6 col-lg-4 col-xl-3 mb-4 food-item" 
                     data-category="{{ item.category }}" 
                     data-price="{{ item.price }}" 
                     data-available="{{ item.is_available|string|lower }}"
                     data-name="{{ item.name|lower }}">
                    <div class="card h-100 shadow-sm food-item-card rounded-3 border-0 transition-all">
                        <!-- Food Image -->
                        <a href="{{ url_for('user.food_detail', food_id=item.id) }}" class="position-relative">
                            {% if item.image_url %}
                            <img src="{{ item.image_url }}" class="card-img-top food-image rounded-top-3" alt="{{ item.name }}" loading="lazy" style="height: 180px; object-fit: cover;">
                            {% else %}
                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center food-image-placeholder rounded-top-3" style="height: 180px;">
                                <i class="fas fa-utensils text-muted fa-2x"></i>
                            </div>
                            {% endif %}

                            <!-- Status badge -->
                            <span class="position-absolute top-0 end-0 m-2 badge {% if item.is_available %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if item.is_available %}Available{% else %}Sold Out{% endif %}
                            </span>
                        </a>

                        <!-- Card Body -->
                        <div class="card-body d-flex flex-column p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <a href="{{ url_for('user.food_detail', food_id=item.id) }}" class="text-decoration-none text-dark flex-grow-1">
                                    <h6 class="card-title mb-0 text-truncate">{{ item.name }}</h6>
                                </a>
                                <span class="badge bg-info text-white ms-2 small">{{ item.preparation_time or 15 }}min</span>
                            </div>
                            
                            <p class="card-text text-muted small mb-2" style="font-size: 0.8rem;">{{ item.description[:80] }}{% if item.description|length > 80 %}...{% endif %}</p>
                            
                            <!-- Review Information -->
                            {% set item_reviews = review_stats.get(item.id, {'total_reviews': 0, 'average_rating': 0}) %}
                            {% if item_reviews.total_reviews > 0 %}
                            <div class="mb-2">
                                <div class="d-flex align-items-center">
                                    <div class="stars-display-small me-2" data-rating="{{ item_reviews.average_rating }}">
                                        {% for i in range(1, 6) %}
                                            <i class="fas fa-star star" data-rating="{{ i }}"></i>
                                        {% endfor %}
                                    </div>
                                    <span class="small text-muted">
                                        {{ item_reviews.average_rating }} ({{ item_reviews.total_reviews }} review{{ 's' if item_reviews.total_reviews != 1 else '' }})
                                    </span>
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="h6 text-success mb-0">₹{{ "%.0f"|format(item.price) }}</span>
                                    <span class="badge bg-secondary small">{{ item.category.replace('_', ' ').title() if item.category else 'General' }}</span>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="d-flex gap-1">
                                    {% if current_user.is_authenticated %}
                                        {% if item.is_available %}
                                            <button class="btn btn-primary btn-sm flex-fill" onclick="addToCart({{ item.id }})">
                                                <i class="fas fa-cart-plus me-1"></i>Add to Cart
                                            </button>
                                        {% else %}
                                            <button class="btn btn-secondary btn-sm flex-fill" disabled>
                                                <i class="fas fa-times me-1"></i>Unavailable
                                            </button>
                                        {% endif %}
                                    {% else %}
                                        <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary btn-sm flex-fill">
                                            <i class="fas fa-sign-in-alt me-1"></i>Login to Order
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    No food items available in this category.
                </div>
                <a href="{{ url_for('user.menu') }}" class="btn btn-primary">View All Items</a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Pagination -->
    {% if food_items.pages > 1 %}
    <nav aria-label="Menu pagination" class="mt-5">
        <ul class="pagination justify-content-center">
            {% if food_items.has_prev %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('user.menu', page=food_items.prev_num, category=current_category) }}">Previous</a>
            </li>
            {% endif %}

            {% for page_num in food_items.iter_pages() %}
                {% if page_num %}
                    {% if page_num != food_items.page %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('user.menu', page=page_num, category=current_category) }}">{{ page_num }}</a>
                    </li>
                    {% else %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                    {% endif %}
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                {% endif %}
            {% endfor %}

            {% if food_items.has_next %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('user.menu', page=food_items.next_num, category=current_category) }}">Next</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

</div>

<style>
/* Enhanced responsive design with better text visibility */
.food-item-card {
    transition: all 0.3s ease;
    height: 100%;
    border: 1px solid rgba(0, 0, 0, 0.125);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
}

.food-item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2) !important;
    border-color: #007bff;
}

/* Card title improvements */
.food-item-card .card-title {
    color: #212529 !important;
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

/* Card text improvements */
.food-item-card .card-text {
    color: #495057 !important;
    font-size: 0.9rem;
    line-height: 1.6;
}

/* Price display */
.food-item-card .text-primary {
    color: #28a745 !important;
    font-weight: 700;
    font-size: 1.2rem;
}

/* Badge improvements */
.food-item-card .badge {
    font-weight: 600;
    padding: 0.35em 0.65em;
    font-size: 0.85rem;
}

.badge-success {
    background-color: #28a745 !important;
}

.badge-warning {
    background-color: #ffc107 !important;
    color: #000 !important;
}

.badge-danger {
    background-color: #dc3545 !important;
}

/* Button hover improvements */
.food-item-card .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    font-weight: 600;
    transition: all 0.3s ease;
}

.food-item-card .btn-primary:hover {
    background-color: #0056b3 !important;
    border-color: #004085 !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
}

.food-item-card .btn-warning {
    background-color: #ffc107;
    border-color: #ffc107;
    color: #000;
    font-weight: 600;
    transition: all 0.3s ease;
}

.food-item-card .btn-warning:hover {
    background-color: #e0a800 !important;
    border-color: #d39e00 !important;
    color: #000 !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
}

.food-item-card .btn-outline-primary {
    color: #007bff;
    border-color: #007bff;
    font-weight: 600;
    transition: all 0.3s ease;
}

.food-item-card .btn-outline-primary:hover {
    background-color: #007bff !important;
    border-color: #007bff !important;
    color: white !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}

/* Card image container */
.food-item-card .card-img-top {
    transition: all 0.3s ease;
    height: 200px;
    object-fit: cover;
}

.food-item-card:hover .card-img-top {
    transform: scale(1.05);
}

.food-item {
    transition: all 0.3s ease;
}

.food-item.hidden {
    display: none !important;
}

/* Sidebar responsive behavior */
#filterColumn {
    transition: all 0.3s ease;
}

#filterColumn.collapsed {
    width: 0;
    padding: 0;
    overflow: hidden;
}

#mainContent {
    transition: all 0.3s ease;
}

#mainContent.expanded {
    flex: 0 0 100%;
    max-width: 100%;
}

/* Responsive grid adjustments */
@media (max-width: 575.98px) {
    .food-item {
        margin-bottom: 1rem;
    }
    
    .card-body {
        padding: 0.75rem;
    }
    
    .card-title {
        font-size: 0.9rem;
    }
}

@media (min-width: 576px) and (max-width: 767.98px) {
    #foodItemsContainer .col-sm-6:nth-child(2n+1) {
        clear: left;
    }
}

@media (min-width: 768px) and (max-width: 991.98px) {
    #foodItemsContainer .col-md-6:nth-child(2n+1) {
        clear: left;
    }
}

@media (min-width: 992px) and (max-width: 1199.98px) {
    #foodItemsContainer .col-lg-4:nth-child(3n+1) {
        clear: left;
    }
}

@media (min-width: 1200px) {
    #foodItemsContainer .col-xl-3:nth-child(4n+1) {
        clear: left;
    }
}

/* Mobile filter sidebar */
@media (max-width: 991.98px) {
    #filterColumn.collapsed {
        display: none;
    }
    
    #filterSidebar {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 85%;
        height: 100vh;
        background: white;
        z-index: 1050;
        overflow-y: auto;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        padding: 20px;
    }
    
    #filterSidebar.show {
        display: block !important;
    }
    
    .filter-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        z-index: 1040;
    }
    
    .filter-overlay.show {
        display: block;
    }
    
    #mainContent {
        width: 100% !important;
        flex: 0 0 100% !important;
        max-width: 100% !important;
    }
    
    #filterSidebar {
        padding-top: 60px;
    }
}

/* Desktop sidebar toggle */
@media (min-width: 992px) {
    .filter-overlay {
        display: none !important;
    }
}

/* Filter section styling */
.filter-section {
    border-bottom: 1px solid #eee;
    padding-bottom: 1rem;
}

.filter-section:last-child {
    border-bottom: none;
}

.filter-title {
    color: #212529 !important;
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

/* Improve form check label visibility */
.form-check-label {
    color: #495057 !important;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.form-check-label:hover {
    color: #007bff !important;
    padding-left: 3px;
}

/* Custom checkbox and radio styling */
.form-check-input {
    cursor: pointer;
    transition: all 0.2s ease;
}

.form-check-input:checked {
    background-color: #007bff;
    border-color: #007bff;
}

.form-check-input:hover {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.15);
}

/* Select dropdown styling */
.form-select {
    color: #212529 !important;
    font-weight: 500;
    transition: all 0.2s ease;
}

.form-select:focus {
    border-color: #86b7fe;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.form-select option {
    color: #212529;
    font-weight: 500;
}

/* Filter sidebar improvements */
.filter-sidebar {
    border: 1px solid #e0e0e0;
}

.filter-sidebar h4 {
    color: #212529 !important;
    font-weight: 700;
}

/* Clear filters button */
#clearAllFiltersBtn {
    font-size: 0.85rem;
    padding: 0.5rem 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

#clearAllFiltersBtn:hover {
    background-color: #dc3545 !important;
    color: white !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
}

/* Star Rating Styles */
.stars-display-small .star {
    color: #ddd;
    font-size: 0.8rem;
    margin-right: 1px;
}

.stars-display-small.filled-1 .star:nth-child(-n+1),
.stars-display-small.filled-2 .star:nth-child(-n+2),
.stars-display-small.filled-3 .star:nth-child(-n+3),
.stars-display-small.filled-4 .star:nth-child(-n+4),
.stars-display-small.filled-5 .star:nth-child(-n+5) {
    color: #ffc107;
}

/* Responsive text adjustments */
@media (max-width: 575.98px) {
    .food-item-card .card-body {
        padding: 0.75rem;
    }
    
    .food-item-card .card-title {
        font-size: 0.9rem;
    }
    
    .food-item-card .card-text {
        font-size: 0.75rem;
    }
    
    .badge.small {
        font-size: 0.65rem;
    }
}
</style>

<script>
// Enhanced menu filtering and responsiveness
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggleFiltersBtn');
    const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
    const filterSidebar = document.getElementById('filterSidebar');
    const filterColumn = document.getElementById('filterColumn');
    const mainContent = document.getElementById('mainContent');
    const clearAllFiltersBtn = document.getElementById('clearAllFiltersBtn');
    const categoryRadios = document.querySelectorAll('input[name="categoryFilter"]');
    const minPriceSelect = document.getElementById('minPriceSelect');
    const maxPriceSelect = document.getElementById('maxPriceSelect');
    const itemsCount = document.getElementById('itemsCount');
    
    let overlay = null;
    let sidebarCollapsed = false;
    
    // Initialize
    function init() {
        // Create overlay for mobile
        if (window.innerWidth < 992) {
            createOverlay();
        }
        
        // Add event listeners
        addEventListeners();
        
        // Initialize filters
        initializeFilters();
    }
    
    function createOverlay() {
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.classList.add('filter-overlay');
            document.body.appendChild(overlay);
            
            overlay.addEventListener('click', closeMobileFilters);
        }
    }
    
    function addEventListeners() {
        // Mobile filter toggle
        if (toggleBtn) {
            toggleBtn.addEventListener('click', toggleMobileFilters);
        }
        
        // Desktop sidebar toggle
        if (toggleSidebarBtn) {
            toggleSidebarBtn.addEventListener('click', toggleDesktopSidebar);
        }
        
        // Clear all filters
        if (clearAllFiltersBtn) {
            clearAllFiltersBtn.addEventListener('click', clearAllFilters);
        }
        
        // Auto-filtering
        categoryRadios.forEach(radio => {
            radio.addEventListener('change', applyFilters);
        });
        
        if (minPriceSelect) {
            minPriceSelect.addEventListener('change', applyFilters);
        }
        
        if (maxPriceSelect) {
            maxPriceSelect.addEventListener('change', applyFilters);
        }
        
        // Window resize handler
        window.addEventListener('resize', handleResize);
        
        // Close mobile filters when clicking close icon
        document.addEventListener('click', function(e) {
            if (e.target.closest('.fa-times')) {
                closeMobileFilters();
            }
        });
    }
    
    function toggleMobileFilters() {
        if (filterSidebar && overlay) {
            const isOpen = filterSidebar.classList.contains('show');
            
            if (isOpen) {
                closeMobileFilters();
            } else {
                openMobileFilters();
            }
        }
    }
    
    function openMobileFilters() {
        if (filterSidebar && overlay) {
            filterSidebar.classList.add('show');
            overlay.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-times me-2"></i>Close Filters';
            }
        }
    }
    
    function closeMobileFilters() {
        if (filterSidebar && overlay) {
            filterSidebar.classList.remove('show');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
            
            if (toggleBtn) {
                toggleBtn.innerHTML = '<i class="fas fa-filter me-2"></i>Filters';
            }
        }
    }
    
    function toggleDesktopSidebar() {
        if (window.innerWidth >= 992) {
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                filterColumn.classList.add('collapsed');
                mainContent.classList.add('expanded');
                toggleSidebarBtn.innerHTML = '<i class="fas fa-chevron-right me-1"></i>Show Filters';
            } else {
                filterColumn.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
                toggleSidebarBtn.innerHTML = '<i class="fas fa-bars me-1"></i>Toggle Filters';
            }
        }
    }
    
    function clearAllFilters() {
        // Reset category to all
        const allCategoryRadio = document.getElementById('categoryAll');
        if (allCategoryRadio) {
            allCategoryRadio.checked = true;
        }
        
        // Reset price selects
        if (minPriceSelect) {
            minPriceSelect.value = '';
        }
        if (maxPriceSelect) {
            maxPriceSelect.value = '';
        }
        
        // Apply filters (show all items)
        applyFilters();
    }
    
    function applyFilters() {
        const foodItems = document.querySelectorAll('.food-item');
        const selectedCategory = document.querySelector('input[name="categoryFilter"]:checked')?.value || 'all';
        const minPrice = parseFloat(minPriceSelect?.value) || 0;
        const maxPrice = parseFloat(maxPriceSelect?.value) || Infinity;
        
        let visibleCount = 0;
        
        foodItems.forEach(item => {
            const itemCategory = item.dataset.category;
            const itemPrice = parseFloat(item.dataset.price);
            const itemAvailable = item.dataset.available === 'true';
            
            let show = true;
            
            // Category filter
            if (selectedCategory !== 'all' && itemCategory !== selectedCategory) {
                show = false;
            }
            
            // Price filter
            if (itemPrice < minPrice || itemPrice > maxPrice) {
                show = false;
            }
            
            if (show) {
                item.classList.remove('hidden');
                visibleCount++;
            } else {
                item.classList.add('hidden');
            }
        });
        
        // Update items count
        if (itemsCount) {
            itemsCount.textContent = `Showing ${visibleCount} item${visibleCount !== 1 ? 's' : ''}`;
        }
    }
    
    function initializeFilters() {
        // Apply initial filters based on current state
        applyFilters();
    }
    
    function handleResize() {
        if (window.innerWidth >= 992) {
            // Desktop mode
            closeMobileFilters();
            
            if (!overlay) return;
            overlay.remove();
            overlay = null;
            
            // Reset desktop sidebar if needed
            if (sidebarCollapsed) {
                filterColumn.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
                sidebarCollapsed = false;
                if (toggleSidebarBtn) {
                    toggleSidebarBtn.innerHTML = '<i class="fas fa-bars me-1"></i>Toggle Filters';
                }
            }
        } else {
            // Mobile mode
            createOverlay();
        }
    }
    
    // Initialize everything
    init();
});

// Sorting functionality (enhanced)
function sortItems(criteria) {
    const container = document.getElementById('foodItemsContainer');
    const items = Array.from(container.querySelectorAll('.food-item:not(.hidden)'));
    
    items.sort((a, b) => {
        switch(criteria) {
            case 'name':
                return a.dataset.name.localeCompare(b.dataset.name);
            case 'name-desc':
                return b.dataset.name.localeCompare(a.dataset.name);
            case 'price-low':
                return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
            case 'price-high':
                return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
            case 'newest':
                // For now, reverse current order as "newest"
                return Math.random() - 0.5;
            default:
                return 0;
        }
    });
    
    // Re-append sorted items
    items.forEach(item => {
        container.appendChild(item);
    });
}

// Cart functionality (if not defined elsewhere)
function addToCart(itemId) {
    if (typeof window.addToCart === 'function') {
        return window.addToCart(itemId);
    }
    
    // Fallback implementation
    fetch(`/cart/add/${itemId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
        },
        body: JSON.stringify({ quantity: 1 })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update cart count if exists
            const cartBadge = document.querySelector('.cart-count-badge');
            if (cartBadge && data.cart_count) {
                cartBadge.textContent = data.cart_count;
            }
            
            // Show success message
            showNotificationMessage('Item added to cart!', 'success');
        } else {
            showNotificationMessage(data.message || 'Error adding item to cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error adding to cart:', error);
        showNotificationMessage('Error adding item to cart', 'error');
    });
}

// Notification helper
function showNotificationMessage(message, type) {
    // Create a simple toast notification
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    `;
    
    document.body.appendChild(toast);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 3000);
}

// Initialize star ratings
function initializeStarRatings() {
    document.querySelectorAll('.stars-display-small').forEach(function(element) {
        const rating = parseFloat(element.dataset.rating);
        const roundedRating = Math.round(rating);
        element.className = element.className.replace(/filled-\d+/, '');
        if (roundedRating > 0) {
            element.classList.add('filled-' + roundedRating);
        }
    });
}

// Initialize tooltips
function initializeTooltips() {
    if (typeof bootstrap !== 'undefined') {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeStarRatings();
    initializeTooltips();
});
</script>

<script src="{{ url_for('static', filename='js/menu.js') }}"></script>
{% endblock %}
